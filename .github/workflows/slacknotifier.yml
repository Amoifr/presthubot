name: Slack Notifier

on:
  schedule:
    - cron:  '0 7 * * 1-5'

jobs:
  slacknotifier:
    runs-on: ubuntu-latest
    name: Slack Notifier
    steps:
      -   name: Setup PHP
          uses: shivammathur/setup-php@v1
          with:
            php-version: '7.3'
            extensions: mbstring, intl, gd, xml, dom, json, fileinfo, curl, zip, iconv

      -   uses: actions/checkout@v2
          with:
            fetch-depth: 0

      -   name: Cache directory cache
          uses: actions/cache@v2
          with:
            path: .cache
            key: ${{ runner.os }}-dot-cache

      -   name: Composer install
          run: composer install --ansi --prefer-dist --no-interaction --no-progress --quiet

      -   name: Write env file
          run: |
              echo 'GH_TOKEN='${{ secrets.GH_TOKEN }} > .env && \
              echo 'SLACK_TOKEN='${{ secrets.SLACK_TOKEN }} >> .env && \
              echo 'SLACK_CHANNEL_CORE='${{ secrets.SLACK_CHANNEL_CORE }} >> .env && \
              echo 'SLACK_CHANNEL_QA='${{ secrets.SLACK_CHANNEL_QA }} >> .env

      -   name: Execute script
          run: php bin/console slack:notifier